import{e as B,r as m,V as A,j as e,h as L,_ as R,f as E,B as v,C as V,M as Q,i as P,W as q,X as W}from"./index-D3MpGbMR.js";import{I as _,C as H,a as O,b as Y,c as Z,d as $}from"./index-z4fhoOdL.js";import{E as G,F as U,Q as X}from"./error-state-BWwSu8xR.js";import{u as J}from"./use-debounce-B1vt3ONT.js";import{P as ee,a as x}from"./schema-RXNTGgsM.js";import{D as te}from"./index-DC99YnAX.js";import{D as se}from"./table-skeleton-DYmyo7_H.js";import{t as D,P as ae,a as re,f as b,b as oe}from"./popover-nv6CeqM9.js";import"./index-DXqQCM1T.js";import"./select-C69YREwq.js";import"./chevrons-right-D8c0Dv2j.js";import"./skeleton-BySlzUNx.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=B("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=B("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);function ie(t,i){const n=D(t.start),l=D(t.end);let r=+n>+l;const d=r?+n:+l,s=r?l:n;s.setHours(0,0,0,0);let a=1;const o=[];for(;+s<=d;)o.push(D(s)),s.setDate(s.getDate()+a),s.setHours(0,0,0,0);return r?o.reverse():o}function ce(t,i){const n=D(t.start),l=D(t.end);let r=+n>+l;const d=r?+n:+l,s=r?l:n;s.setHours(0,0,0,0),s.setDate(1);let a=1;const o=[];for(;+s<=d;)o.push(D(s)),s.setMonth(s.getMonth()+a);return r?o.reverse():o}const de={quantity:ee("Quantity",4),chargeableWeight:x(null,5),rate:x(),amount:x(),odaCharge:x(null,4),additionalCharge:x(null,4),totalAmount:x()},me=de,g=({initialData:t,currentField:i})=>{const n=`${t[i]}`||"",l=me[i],[r,d]=m.useState(!1),[s,a]=m.useState(n),[o,u]=m.useState(n),[c,f]=m.useState(),[w,j]=m.useState(!1),[M,N]=m.useState(!1),C=J(s,500),[S]=A();m.useEffect(()=>{r&&(u(s),f(void 0),N(!1))},[r]);const K=async h=>{try{j(!0);const y=await S({id:t==null?void 0:t.id,values:h}).unwrap()}catch(y){console.log(y),R.error("Something went wrong")}finally{j(!1)}};m.useEffect(()=>{if(M){const h={[i]:C};K(h)}},[C]);const z=h=>{var k;u(h);const y=l.safeParse(h);if(y.success)f(void 0),a(h),N(!0);else{const T=y.error.flatten();f((k=T.formErrors)==null?void 0:k[0])}},I=h=>{h.key==="Enter"&&d(!1)};return e.jsxs("div",{className:"flex flex-col items-center justify-center w-32 mx-auto",children:[!r&&e.jsx("button",{className:L("w-20 py-2",w&&"animate-pulse text-blue-500"),onClick:()=>d(!0),children:i==="quantity"?s:parseFloat(s).toFixed(2)}),r&&e.jsxs(e.Fragment,{children:[e.jsx(_,{placeholder:"0",className:"w-32",type:"number",value:o,autoFocus:!0,onChange:h=>{z(h.target.value)},onBlur:()=>d(!1),onKeyDown:I}),e.jsx("p",{className:"text-xs text-red-500",children:c})]})]})},F=[{id:"lr",accessorKey:"lr",header:"LR #"},{accessorKey:"consigneeName",header:"Sender"},{accessorKey:"consignerName",header:"Receiver"},{accessorKey:"quantity",header:"Qty",cell:({row:t})=>e.jsx(g,{initialData:t.original,currentField:"quantity"})},{accessorKey:"chargeableWeight",header:"Chargeable Weight",cell:({row:t})=>e.jsx(g,{initialData:t.original,currentField:"chargeableWeight"})},{accessorKey:"rate",header:"Rate",cell:({row:t})=>e.jsx(g,{initialData:t.original,currentField:"rate"})},{accessorKey:"amount",header:"Amount",cell:({row:t})=>e.jsx(g,{initialData:t.original,currentField:"amount"})},{accessorKey:"odaCharge",header:"ODA Charge",cell:({row:t})=>e.jsx(g,{initialData:t.original,currentField:"odaCharge"})},{accessorKey:"additionalCharge",header:"Additional Charge",cell:({row:t})=>e.jsx(g,{initialData:t.original,currentField:"additionalCharge"})},{accessorKey:"totalAmount",header:"Total Amount",cell:({row:t})=>e.jsx(g,{initialData:t.original,currentField:"totalAmount"})},{accessorKey:"locationName",header:"Location"}],p=new Date().getFullYear(),ue=(t=null)=>{const i=new Date().getMonth();let n=new Date(p,i+1,1),l=new Date(p,0,1);t&&t!==p&&t<=p&&(n=new Date(t,12,1),l=new Date(t,0,1));const r=ce({start:n,end:l});return r.map((s,a)=>{const o=ie({start:s,end:r[a-1>0?a-1:0]}).length,u=o<28?30:o-1;return{label:b(s,"MMM yyy"),fromDate:b(s,"yyy-MM-01"),toDate:b(s,`yyy-MM-${u}`)}}).slice(1)},he=({})=>{const[t,i]=m.useState(p),[n,l]=m.useState([]);m.useState();const[r,d]=E(),s=r.get("fromDate"),a=r.get("toDate"),o=r.get("filter"),u=c=>{d(f=>P(f,c))};return m.useEffect(()=>{if(o==="month"&&s){const c=parseInt(s.slice(0,4));i(c)}},[s,a]),m.useEffect(()=>{l(ue(t))},[t]),m.useEffect(()=>{if(o==="month"&&s&&!a){const c=n.find(f=>f.fromDate===s);c&&u({toDate:c.toDate})}},[o,s]),e.jsxs(ae,{children:[e.jsx(re,{asChild:!0,children:e.jsxs(v,{size:"sm",variant:"outline",className:"w-32 justify-between",children:[o==="month"&&s?b(s,"MMM yyy"):"Month",e.jsx(le,{className:"size-3 ml-2"})]})}),e.jsxs(oe,{className:"w-44",children:[e.jsxs("div",{className:"mb-5 flex items-center justify-between gap-2",children:[e.jsx(v,{onClick:()=>i(c=>c-1),variant:"ghost",size:"icon",children:e.jsx(V,{className:"size-4"})}),e.jsx("p",{className:"text-sm",children:t}),e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>i(c=>c+1),disabled:t===p,children:e.jsx(Q,{className:"size-4"})})]}),e.jsx("div",{className:"flex flex-col",children:n.map(c=>e.jsx(fe,{month:c}))})]})]})},fe=({month:t})=>{const[i,n]=E(),l=i.get("fromDate"),r=i.get("filter"),d=t.fromDate===l&&r==="month",s=o=>{n(u=>P(u,o))},a=()=>{if(d)s({fromDate:null,toDate:null,offset:0,filter:null});else{const{fromDate:o,toDate:u}=t;s({fromDate:o,toDate:u,offset:0,filter:"month"})}};return e.jsxs(v,{onClick:a,variant:"ghost",size:"sm",className:"relative",children:[d&&e.jsx(ne,{className:"absolute left-3 size-3"}),t.label]})},Se=({})=>{const[t,i]=E();console.log("ID",F[0].id);const n=t.get("limit")||"15",l=t.get("offset")||"0",r=t.get("search"),d=t.get("fromDate"),s=t.get("toDate"),{data:a,isLoading:o,isFetching:u,isError:c,isSuccess:f}=q({limit:n,offset:l,search:r,fromDate:d,toDate:s}),w=a==null?void 0:a.data.results;return m.useEffect(()=>{if(a!=null&&a.data&&a.data.limit){const{limit:j,total_results:M,offset:N}=a.data,C=Math.floor(M/j)+1;i(S=>P(S,{pages:C,limit:j,offset:N}))}},[a]),e.jsxs("div",{className:"relative h-full px-2 md:px-8 mx-auto py-4 space-y-4",children:[c&&e.jsx(G,{message:"Error fetching Billings"}),e.jsxs("header",{className:"flex flex-col gap-5 md:flex-row w-full md:items-center md:justify-between",children:[e.jsx("div",{}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(he,{}),e.jsxs(v,{size:"sm",variant:"outline",children:[e.jsx(U,{size:15,className:"mr-2 stroke-[#FF6700]"})," Export Bills"]})]})]}),e.jsx("main",{className:"w-full h-full",children:e.jsxs(H,{className:"dark:bg-[#121717]",children:[e.jsxs(O,{className:"flex md:flex-row gap-5 md:justify-between ",children:[e.jsxs("div",{children:[e.jsxs(Y,{className:"flex gap-2 items-center text-lg",children:[e.jsx(W,{className:"h-5 w-5 stroke-orange-500"}),"Billings"]}),e.jsxs(Z,{children:["Manage billings.",(a==null?void 0:a.data)&&a.data.total_results>0&&e.jsxs("span",{className:" ml-2",children:[e.jsx("span",{className:"font-semibold",children:a.data.total_results})," ","results found."]})]})]}),e.jsx("div",{className:"flex-1 flex flex-col gap-3 max-w-sm",children:e.jsx(X,{placeholder:"Search LR #"})})]}),e.jsx($,{className:"relative p-0",children:o||u?e.jsx(se,{columns:F}):e.jsx(te,{columns:F,data:w||[],stickyIndex:!0})})]})})]})};export{Se as default};
