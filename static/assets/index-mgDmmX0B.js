import{c as D,j as e,B as S,b as E,$ as ee,r as x,m as se,i as re,l as W,_ as B,o as ne,q as te,I as ce,J as ae,K as de,L as oe,P as H,M as v}from"./index-D023Ew-Q.js";import{F as l,a as i,b as o,c as h,d as m,T as I,z as c,u as le,t as ie,e as he,S as me,H as xe,f as ue}from"./spinner-akWaBqIC.js";import{C as u,a as g,b as j,c as P,d as p}from"./alert-dialog-BTaYzCtj.js";import{P as O,b as X,f as F,c as Q,d as V,D as A,S as ge,C as je,a as pe,e as z}from"./consignment-status-DAKHLlIM.js";import{I as q}from"./input-Do_bMhuR.js";import{$ as be}from"./select-B-I5N_nw.js";import{C as fe,D as ye}from"./index-lV-nIdEi.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=D("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),Ce=({control:s})=>e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsx(j,{children:"Consignment Details"}),e.jsx(P,{children:"Basic details"})]}),e.jsx(p,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsx(l,{control:s,name:"lr",render:({field:r})=>e.jsxs(i,{children:[e.jsx(o,{className:"text-primary",children:"LR Number"}),e.jsx(h,{children:e.jsx(q,{placeholder:"XXXX",className:"w-full",type:"number",...r})}),e.jsx(m,{})]})}),e.jsx(l,{control:s,name:"lrDateFull",render:({field:r})=>e.jsxs(i,{className:"flex flex-col",children:[e.jsx(o,{className:"text-primary mb-2",children:"LR Date"}),e.jsxs(O,{children:[e.jsx(X,{asChild:!0,children:e.jsx(h,{children:e.jsxs(S,{variant:"outline",className:E("w-full pl-3 text-left font-normal",!r.value&&"text-muted-foreground"),children:[r.value?F(r.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(K,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(Q,{className:"w-auto p-0",align:"start",children:e.jsx(V,{mode:"single",selected:r.value,onSelect:r.onChange,disabled:a=>a>new Date||a<new Date("1900-01-01"),initialFocus:!0})})]}),e.jsx(m,{})]})})]})})]}),ve=({control:s})=>e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsx(j,{children:"Distributors"}),e.jsx(P,{children:"Sender and reciever"})]}),e.jsx(p,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsx(l,{control:s,name:"consignee_id",render:({field:r})=>e.jsxs(i,{className:"w-full",children:[e.jsx(o,{className:"text-primary",children:"Sender"}),e.jsx(h,{children:e.jsx(A,{value:r.value,onChange:r.onChange,placeholder:"Select Sender"})}),e.jsx(m,{})]})}),e.jsx(l,{control:s,name:"consigner_id",render:({field:r})=>e.jsxs(i,{className:"w-full",children:[e.jsx(o,{className:"text-primary",children:"Receiver"}),e.jsx(h,{children:e.jsx(A,{value:r.value,onChange:r.onChange,placeholder:"Select Receiver"})}),e.jsx(m,{})]})})]})})]}),Ne=({control:s})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(j,{children:"Status"})}),e.jsx(p,{children:e.jsx("div",{className:"grid gap-6",children:e.jsx(l,{control:s,name:"status",render:({field:r})=>e.jsxs(i,{children:[e.jsx(o,{className:"text-primary",children:"Consignment Status"}),e.jsx(h,{children:e.jsx(ge,{value:r.value,onChange:r.onChange})}),e.jsx(m,{})]})})})})]}),we=({control:s})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(j,{children:"Channel Partner"})}),e.jsx(p,{children:e.jsx("div",{className:"grid gap-6",children:e.jsx(l,{control:s,name:"vendor_id",render:({field:r})=>e.jsxs(i,{className:"w-full",children:[e.jsx(o,{className:"text-primary",children:"Channel Partner"}),e.jsx(h,{children:e.jsx(je,{value:r.value,onChange:r.onChange,placeholder:"Select Channel Partner"})}),e.jsx(m,{})]})})})})]}),ke=({control:s})=>e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsx(j,{children:"Remarks"}),e.jsx(P,{children:"Consignment remarks"})]}),e.jsx(p,{children:e.jsx("div",{className:"grid gap-6",children:e.jsx(l,{control:s,name:"remarks",render:({field:r})=>e.jsxs(i,{className:"grid gap-3 flex-1",children:[e.jsx(o,{className:"text-primary",children:"Additional Remarks"}),e.jsx(h,{children:e.jsx(I,{value:r.value,onChange:r.onChange,className:"min-h-32"})}),e.jsx(m,{})]})})})})]}),U="Switch",[$e,Ue]=ee(U),[Se,Pe]=$e(U),Fe=x.forwardRef((s,r)=>{const{__scopeSwitch:a,name:b,checked:f,defaultChecked:t,required:w,disabled:N,value:k="on",onCheckedChange:$,...R}=s,[n,d]=x.useState(null),y=se(r,_=>d(_)),C=x.useRef(!1),T=n?!!n.closest("form"):!0,[M=!1,Y]=re({prop:f,defaultProp:t,onChange:$});return x.createElement(Se,{scope:a,checked:M,disabled:N},x.createElement(W.button,B({type:"button",role:"switch","aria-checked":M,"aria-required":w,"data-state":G(M),"data-disabled":N?"":void 0,disabled:N,value:k},R,{ref:y,onClick:ne(s.onClick,_=>{Y(Z=>!Z),T&&(C.current=_.isPropagationStopped(),C.current||_.stopPropagation())})})),T&&x.createElement(_e,{control:n,bubbles:!C.current,name:b,value:k,checked:M,required:w,disabled:N,style:{transform:"translateX(-100%)"}}))}),Re="SwitchThumb",Me=x.forwardRef((s,r)=>{const{__scopeSwitch:a,...b}=s,f=Pe(Re,a);return x.createElement(W.span,B({"data-state":G(f.checked),"data-disabled":f.disabled?"":void 0},b,{ref:r}))}),_e=s=>{const{control:r,checked:a,bubbles:b=!0,...f}=s,t=x.useRef(null),w=be(a),N=te(r);return x.useEffect(()=>{const k=t.current,$=window.HTMLInputElement.prototype,n=Object.getOwnPropertyDescriptor($,"checked").set;if(w!==a&&n){const d=new Event("click",{bubbles:b});n.call(k,a),k.dispatchEvent(d)}},[w,a,b]),x.createElement("input",B({type:"checkbox","aria-hidden":!0,defaultChecked:a},f,{tabIndex:-1,ref:t,style:{...s.style,...N,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function G(s){return s?"checked":"unchecked"}const J=Fe,Ee=Me,L=x.forwardRef(({className:s,...r},a)=>e.jsx(J,{className:E("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...r,ref:a,children:e.jsx(Ee,{className:E("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));L.displayName=J.displayName;const qe=({control:s})=>e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsx(j,{children:"Mode"}),e.jsx(P,{children:"Consignment Mode"})]}),e.jsx(p,{children:e.jsx("div",{className:"grid gap-6",children:e.jsx(l,{control:s,name:"consignmentMode",render:({field:r})=>e.jsxs(i,{className:"flex items-center gap-4",children:[e.jsx(o,{className:"text-primary mt-2",children:"Reverse"}),e.jsx(h,{children:e.jsx(L,{className:"data-[state=checked]:bg-yellow-400 dark:data-[state=checked]:bg-yellow-600 data-[state=unchecked]:bg-fuchsia-400 dark:data-[state=unchecked]:bg-fuchsia-700",checked:r.value,onCheckedChange:r.onChange})}),e.jsx(o,{className:"text-primary mt-2",children:"Forward"}),e.jsx(m,{})]})})})})]}),Le=({control:s})=>e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsx(j,{children:"Consignment Metrics"}),e.jsx(P,{children:"Quantity and weight"})]}),e.jsx(p,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsx(l,{control:s,name:"quantity",render:({field:r})=>e.jsxs(i,{className:"",children:[e.jsx(o,{className:"text-primary",children:"Quantity"}),e.jsx(h,{children:e.jsx(q,{placeholder:"0",className:"w-full",type:"number",...r})}),e.jsx(m,{})]})}),e.jsx(l,{control:s,name:"weight",render:({field:r})=>e.jsxs(i,{className:"",children:[e.jsx(o,{className:"text-primary",children:"Weight (KG)"}),e.jsx(h,{children:e.jsx(q,{placeholder:"0.00 Kg",className:"w-full",type:"number",...r})}),e.jsx(m,{})]})})]})})]}),ze=({control:s,lrDateFull:r})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(j,{children:"Delivery Date"})}),e.jsx(p,{children:e.jsx("div",{className:"grid gap-6",children:e.jsx(l,{control:s,name:"deliveryDateFull",render:({field:a})=>e.jsxs(i,{className:"flex flex-col",children:[e.jsx(o,{className:"text-primary mb-2",children:"Delivery Date"}),e.jsxs(O,{children:[e.jsx(X,{asChild:!0,children:e.jsx(h,{children:e.jsxs(S,{variant:"outline",className:E("w-full pl-3 text-left font-normal",!a.value&&"text-muted-foreground"),children:[a.value?F(a.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(K,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(Q,{className:"w-auto p-0",align:"start",children:e.jsx(V,{mode:"single",selected:a.value,onSelect:a.onChange,disabled:b=>b>new Date||b<r,initialFocus:!0})})]}),e.jsx(m,{})]})})})})]}),Be=({form:s})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(l,{control:s.control,name:"delayed",render:({field:r})=>e.jsxs(i,{className:"flex items-center gap-4 justify-between",children:[e.jsx(o,{className:"text-primary text-base mt-2",children:e.jsx(j,{children:"Delayed"})}),e.jsx(h,{children:e.jsx(L,{className:"data-[state=checked]:bg-blue-400 dark:data-[state=checked]:bg-blue-600",checked:r.value,onCheckedChange:r.onChange})}),e.jsx(m,{})]})})}),e.jsx(p,{children:e.jsx("div",{className:"grid gap-6",children:s.watch("delayed")&&e.jsx(l,{control:s.control,name:"delayedReason",render:({field:r})=>e.jsxs(i,{className:"grid gap-3 flex-1",children:[e.jsx(o,{className:"text-primary",children:"Reason for delay"}),e.jsx(h,{children:e.jsx(I,{value:r.value,onChange:r.onChange})}),e.jsx(m,{})]})})})})]}),Ie=({form:s})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(l,{control:s.control,name:"notified",render:({field:r})=>e.jsxs(i,{className:"flex items-center gap-4 justify-between",children:[e.jsx(o,{className:"text-primary text-base mt-2",children:e.jsx(j,{children:"Notified"})}),e.jsx(h,{children:e.jsx(L,{className:"data-[state=checked]:bg-blue-400 dark:data-[state=checked]:bg-blue-600",checked:r.value,onCheckedChange:r.onChange})}),e.jsx(m,{})]})})}),e.jsx(p,{children:e.jsx("div",{className:"grid gap-6",children:s.watch("notified")&&e.jsx(l,{control:s.control,name:"notifiedDateFull",render:({field:r})=>e.jsxs(i,{className:"grid gap-3 flex-1",children:[e.jsx(o,{className:"text-primary",children:"Date of notification"}),e.jsx(h,{children:e.jsx(pe,{value:r.value,onChange:r.onChange,placeholder:"select date"})}),e.jsx(m,{})]})})})})]}),Te=({form:s})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(j,{children:"Additional Charges"})}),e.jsx(p,{children:e.jsxs("div",{className:"grid  gap-6",children:[e.jsx(l,{control:s.control,name:"additionalCharges",render:({field:r})=>e.jsxs(i,{children:[e.jsx(o,{className:"text-primary mt-2",children:"Charges"}),e.jsx(h,{children:e.jsx(q,{placeholder:"0.00",className:"w-full",type:"number",step:.01,value:r.value,onChange:r.onChange,onBlur:r.onBlur,onWheel:a=>{a.currentTarget.blur()}})}),e.jsx(m,{})]})}),e.jsx(l,{control:s.control,name:"additionalChargesReason",render:({field:r})=>e.jsxs(i,{className:"grid gap-3 flex-1",children:[e.jsx(o,{className:"text-primary",children:"Reason"}),e.jsx(h,{children:e.jsx(I,{value:r.value,onChange:r.onChange})}),e.jsx(m,{})]})})]})})]}),He=c.object({lr:c.string().min(1,{message:"Cannot create consignment without LR number"}).refine(s=>{const r=Number(s);return!isNaN(r)&&r!==0},{message:"LR Number cannot be zero"}).refine(s=>Number(s)>-1,{message:"LR Number cannot be negative"}),lrDateFull:c.date(),lrDate:c.optional(c.string()),deliveryDateFull:c.optional(c.date()),deliveryDate:c.optional(c.string()),quantity:c.string().refine(s=>{const r=Number(s);return!isNaN(r)&&r!==0},{message:"Quantity cannot be zero"}).refine(s=>Number(s)>-1,{message:"Quantity cannot be negative"}),weight:c.string().refine(s=>{const r=Number(s);return!isNaN(r)&&r!==0},{message:"Weight cannot be zero"}).refine(s=>Number(s)>-1,{message:"Weight cannot be negative"}),remarks:c.string(),consignee_id:c.string({required_error:"Please select a sender"}).min(1,{message:"Please select a sender"}),consigner_id:c.string({required_error:"Please select a receiver"}).min(1,{message:"Please select a receiver"}),vendor_id:c.string({required_error:"Please select a vendor"}).min(1,{message:"Please select a vendor"}),consignmentMode:c.boolean().default(!0),mode:c.optional(c.string()),status:c.string({required_error:"Please select a status"}).min(1,{message:"Please select a status"}),delayed:c.boolean().default(!1),delayedReason:c.optional(c.string()),notified:c.boolean().default(!1),notifiedDateFull:c.optional(c.date()),notifiedDate:c.optional(c.string()).nullable(),additionalCharges:c.optional(c.string()).refine(s=>s&&parseFloat(s)>=0,{message:"Must be greater than or equal to zero"}).refine(s=>s&&/^\d+(\.\d{1,2})?$/.test(s),{message:"Must be up to 2 decimal places"}),additionalChargesReason:c.optional(c.string())}),Ge=({initialData:s})=>{const r=ce(),[a]=ae(),[b]=de(),f=!!s,t=le({resolver:ie(He),defaultValues:{lr:(s==null?void 0:s.lr)||"",lrDateFull:s?new Date(s.lrDate):new Date,deliveryDateFull:s!=null&&s.deliveryDate?new Date(s.deliveryDate):void 0,consignmentMode:s?s.mode.toLowerCase()===z.FORWARD:!0,remarks:(s==null?void 0:s.remarks)||"",quantity:`${s==null?void 0:s.quantity}`||"",weight:`${s==null?void 0:s.weight}`||"",consignee_id:s?`${s==null?void 0:s.consignee_id}`:"",consigner_id:s?`${s==null?void 0:s.consigner_id}`:"",vendor_id:(s==null?void 0:s.vendor_id)||"",status:(s==null?void 0:s.status.toLowerCase())||"",delayed:(s==null?void 0:s.delayed)||!1,delayedReason:(s==null?void 0:s.delayedReason)||void 0,notified:(s==null?void 0:s.notified)||!1,notifiedDateFull:s!=null&&s.notifiedDate?new Date(s.notifiedDate):void 0,additionalCharges:(s==null?void 0:s.additionalCharges)||"0.00",additionalChargesReason:(s==null?void 0:s.additionalChargesReason)||""},mode:"onChange",reValidateMode:"onChange",criteriaMode:"firstError",shouldFocusError:!0,shouldUnregister:!0});async function w(n){if(n.lrDate=F(n.lrDateFull,"yyyy-MM-dd"),n.deliveryDateFull){if(n.deliveryDateFull.setHours(0,0,0,0)<n.lrDateFull.setHours(0,0,0,0)){v.error("Please correct the form"),t.setError("deliveryDateFull",{message:"The delivery date cannot be earlier than the LR date",type:"custom"});return}n.deliveryDate=F(n.deliveryDateFull,"yyyy-MM-dd")}if(n.delayed){if(!n.delayedReason){v.error("Please correct the form"),t.setError("delayedReason",{message:"Delayed reason is required",type:"custom"});return}}else n.delayedReason="";if(n.notified)if(n.notifiedDateFull)n.notifiedDate=F(n.notifiedDateFull,"yyyy-MM-dd");else{v.error("Please correct the form"),t.setError("notifiedDateFull",{message:"Notified Date is required",type:"custom"});return}else n.notifiedDateFull=void 0,n.notifiedDate=null;n.additionalCharges||(n.additionalCharges="0.00"),n.mode=n.consignmentMode?z.FORWARD:z.REVERSE,f?await k(n):await N(n)}const N=async n=>{try{const d=await a(n).unwrap();v.success("Consignment created"),r("/consignments"),t.reset()}catch(d){if((d==null?void 0:d.status)===400){v.error("Invalid data: Please review and correct the form.");const{message:y}=d==null?void 0:d.data;y&&Object.keys(y).map(C=>{t.setError(C,{message:y[C][0],type:"server"})})}else v.error("Something went wrong")}},k=async n=>{try{const d=await b({id:s==null?void 0:s.lr,values:n}).unwrap();v.success("Consignment updated successfully")}catch(d){if((d==null?void 0:d.status)===400){v.error("Invalid data: Please review and correct the form.");const{message:y}=d==null?void 0:d.data;y&&Object.keys(y).map(C=>{t.setError(C,{message:y[C][0],type:"server"})})}else v.error("Something went wrong")}},$=()=>r(".."),R=()=>{f?t.reset():$()};return e.jsx("div",{className:"relative mx-auto p-4 lg:p-6 max-w-7xl grid auto-rows-max gap-4 animate-in",children:e.jsx(he,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(w),children:[t.formState.isLoading||t.formState.isSubmitting&&e.jsx("div",{className:"absolute -left-2 z-30 w-full h-full bg-transparent backdrop-blur-sm flex py-72 justify-center",children:e.jsx(me,{})}),e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsxs("div",{className:"flex items-center gap-4 py-2",children:[e.jsx(S,{onClick:$,variant:"outline",size:"icon",className:"h-7 w-7",type:"button",children:e.jsx(oe,{className:"h-4 w-4"})}),s?e.jsxs("h1",{className:"flex gap-2 shrink-0 whitespace-nowrap text-xl font-semibold tracking-tight sm:grow-0 text-ellipsis",children:[e.jsx(H,{})," Consignment ",e.jsx(xe,{})," ",s.lr," ",e.jsx(fe,{status:s.status})]}):e.jsxs("h1",{className:"flex items-center gap-2 shrink-0 whitespace-nowrap text-xl font-semibold tracking-tight sm:grow-0 text-ellipsis",children:[e.jsx(H,{})," New Consignment"," "]})]}),e.jsxs("div",{className:"flex items-center gap-4 py-2",children:[e.jsx(S,{onClick:R,variant:"outline",size:"sm",type:"button",children:"Discard"}),e.jsx(S,{type:"submit",variant:"orange",size:"sm",disabled:!t.formState.isValid||t.formState.isSubmitting||!t.formState.touchedFields,children:"Save Consignment"})]})]}),e.jsxs("div",{className:"mt-5 grid gap-4  lg:grid-cols-3 lg:gap-8",children:[e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 lg:col-span-2 lg:gap-8",children:[e.jsx(Ce,{control:t.control}),e.jsx(ve,{control:t.control}),e.jsx(Le,{control:t.control}),e.jsxs("div",{className:"grid  lg:grid-cols-2 gap-4",children:[e.jsx(Be,{form:t}),e.jsx(Ie,{form:t})]}),e.jsx(ke,{control:t.control})]}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 lg:gap-8",children:[e.jsx(qe,{control:t.control}),e.jsx(Ne,{control:t.control}),t.watch("status")==="delivered"&&e.jsx(ze,{lrDateFull:t.watch("lrDateFull"),control:t.control}),e.jsx(we,{control:t.control}),e.jsx(Te,{form:t}),f&&s&&e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsx(j,{children:"Delete Consignment"}),e.jsx(P,{children:"Permanently delete consignment"})]}),e.jsx(p,{children:e.jsx(ye,{consignmentName:s.lr,lrNumber:s.lr,children:e.jsxs(S,{size:"sm",variant:"destructive",type:"button",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"})," Delete"]})})})]})]})]})]})})})};export{Ge as C};
